# relative working directory
function wd {
    echo ${$(pwd)/$HOME\//}
}

# quick history searches
function h {
    history -df -100000 | grep $1
}

# process management
function pg {
    ps -Af | grep $1 | grep -v grep
}

# head helper functions
function hl {
    head -n10 $1 | less
}
function hv {
    head -n10 $1 | vd -
}

#
# fzf notes
# 

# edit note
function n {
    pwd=`pwd`

    cd ~/d/notes
    target=`fd -t f md | grep --color='none' "$1" | fzf -1 --exact`

    if [ ! -z "$target" ]; then
        vim $target
    fi

    cd $pwd
}

# add note
function a {
    pwd=`pwd`

    cd ~/d/notes

    # get directory to store note in
    target=`fd -t d | grep --color='none' "$1" | fzf -1 --exact`

    # prompt user for filename
    if [ ! -z "$target" ]; then
        vared -p "Filename? (${target}/XX): " -c fname
        mkdir -p $fname
        vim $target/$fname
    fi

    cd $pwd
}

# fzf confs
function c {
    vim `fd --regex 'conf|init|rc' --exclude Extracted ~/.dotfiles | grep --color='none' "$1" | fzf -1 --exact`
}

# vim + ag
function va {
    nvim $(ag -l $1)
}

# zcat | wc -l
function zcl {
    zcat $1 | wc -l
}

# number of columns
function nc {
    if [[ $1 == *.tsv* ]]; then
        csvgrep -n -t $1 | wc -l
    else
        csvgrep -n $1 | wc -l
    fi
}

# feh browse dir
function fehd {
    feh â€“start-at $1
}

# syntax highlighting in less 
function les {
    src-hilite-lesspipe.sh "$1" | less -R
}

#
# ffmpeg h.265 video conversion
# 
# <input> <start> <duration>
# 
function ffh265 {
    local infile=$1
    local ext="${infile##*.}"
    local outfile=${infile/$ext/mp4}

    # convert entire video
    if [ $# -eq 1 ]; then
        cmd="ffmpeg -i $infile -c:v libx265 -crf 28 -preset medium -c:a aac -b:a 192k $outfile"
        echo $cmd
    else
        local start=$2
        local duration=$3

        # otherwise, if start and duration specified, convert a specific region;
        # note that when the "-ss" option is used, timestamp gets reset, and so 
        # a duration (-t) must be used in place of the "-to" switch
        cmd="ffmpeg -ss \"$start\" -i $infile -t \"$duration\" -c:v libx265 -crf 28 -preset medium -c:a aac -b:a 192k $outfile"
        echo $cmd
    fi
}

